<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Double Jeopardy: Air Quality (2021–2025)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />

  <!-- Plotly (interactive charts) -->
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <!-- PapaParse (CSV parsing in the browser) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>
  <header class="hero">
    <div class="hero-inner">
      <div class="badge">2026 Datathon • AQI 2021–2025</div>
      <h1>Double Jeopardy Counties</h1>
      <p class="subtitle">
        Where <strong>chronic daily pollution</strong> meets <strong>extreme air quality events</strong>.
      </p>

      <div class="controls">
        <div class="control">
          <label for="scope">Scope</label>
          <select id="scope">
            <option value="all" selected>All rows in data</option>
            <option value="us">U.S. states + DC only</option>
          </select>
          <div class="help">Applies to charts + thresholds.</div>
        </div>

        <div class="control">
          <label for="topn-chronic">Top counties (Chronic)</label>
          <div class="range-row">
            <input id="topn-chronic" type="range" min="5" max="50" step="1" value="15" />
            <span class="pill"><span id="topn-chronic-value">15</span></span>
          </div>
          <div class="help">Chart 1 count (default 15).</div>
        </div>

        <div class="control">
          <label for="topn-acute">Top counties (Acute)</label>
          <div class="range-row">
            <input id="topn-acute" type="range" min="5" max="50" step="1" value="15" />
            <span class="pill"><span id="topn-acute-value">15</span></span>
          </div>
          <div class="help">Chart 2 count (default 15).</div>
        </div>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="kpi-label">Counties analyzed</div><div id="kpi-total" class="kpi-value">—</div></div>
        <div class="kpi"><div class="kpi-label">Double Jeopardy counties</div><div id="kpi-dj" class="kpi-value">—</div></div>
        <div class="kpi"><div class="kpi-label">Chronic threshold (90th % Avg Median AQI)</div><div id="kpi-chronic" class="kpi-value">—</div></div>
        <div class="kpi"><div class="kpi-label">Acute threshold (90th % Avg Max AQI)</div><div id="kpi-acute" class="kpi-value">—</div></div>
      </div>
    </div>
  </header>

  <section id="error-box" class="error" style="display:none;">
    <h2>Dashboard Error</h2>
    <p class="caption">One or more files failed to load. Details:</p>
    <pre class="mono" id="error-details"></pre>
    <div class="hint">
      <p><strong>Local run:</strong> <code>python -m http.server 8000</code> then open <code>http://localhost:8000</code>.</p>
      <p><strong>GitHub Pages:</strong> ensure your repo root contains <code>dashboard_data.json</code> and the annual CSVs.</p>
    </div>
  </section>

  <main class="container">
    <section class="panel">
      <h2>The Question</h2>
      <p>
        <strong>Which counties face both frequent and severe pollution?</strong>
        We measure frequency using a county’s <em>5-year average Median AQI</em> (the daily “grind”) and severity using its
        <em>5-year average Max AQI</em> (extreme events). Counties in the <strong>top 10%</strong> for both metrics are labeled
        <strong>“Double Jeopardy”</strong>.
      </p>
      <p class="callout">
        In this run, we identify <strong><span id="story-dj">—</span></strong> Double Jeopardy counties out of
        <strong><span id="story-total">—</span></strong> analyzed.
      </p>
    </section>

    <section class="grid">
      <section class="panel">
        <h2>1) Chronic Burden (Daily “Grind”)</h2>
        <p class="caption">Top <span id="topn-chronic-caption">15</span> counties by 5-year average <strong>Median AQI</strong>.</p>
        <div id="chart-chronic" class="chart"></div>
      </section>

      <section class="panel">
        <h2>2) Acute Events (Extreme AQI)</h2>
        <p class="caption">Top <span id="topn-acute-caption">15</span> counties by 5-year average <strong>Max AQI</strong>.</p>
        <div id="chart-acute" class="chart"></div>
      </section>
    </section>

    <section class="panel">
      <h2>3) Chronic vs Acute: The Double Jeopardy Zone</h2>

      <div class="scatter-head">
        <p class="caption">
          Scatter of 5-year average metrics per county (Mono County, CA removed as an outlier).
          Use Plotly controls to zoom in/out. Select a state to focus.
        </p>
        <div class="scatter-controls">
          <label for="state-select">Focus state</label>
          <select id="state-select">
            <option value="ALL" selected>All states</option>
          </select>
        </div>
      </div>

      <div class="scatter-grid">
        <div>
          <div id="chart-scatter" class="chart tall"></div>
        </div>
        <div>
          <div id="chart-dj-top5" class="chart tall"></div>
        </div>
      </div>

      <div class="legend-note">
        <span class="dot low"></span> Low Risk
        <span class="dot chronic"></span> High Chronic
        <span class="dot acute"></span> High Acute
        <span class="dot dj"></span> Double Jeopardy
      </div>
    </section>

    <section class="panel">
      <h2>4) Most Livable Counties</h2>
      <p class="caption">Top 15 counties with the <strong>lowest</strong> 5-year average <strong>Median AQI</strong>.</p>
      <div id="chart-livable" class="chart"></div>
    </section>

    <section class="panel">
      <h2>5) Geospatial Heatmap: High AQI Days by State (2021–2025)</h2>
      <p class="caption">State choropleth built from annual CSVs (sum of USG + Unhealthy + Very Unhealthy + Hazardous days).</p>
      <div id="chart-heatmap" class="chart tall"></div>
    </section>

    <footer class="footer">
      <p>Static dashboard using Plotly + PapaParse. Data: AQI 2021–2025.</p>
    </footer>
  </main>

  <script src="script.js"></script>
</body>
</html>
